! Testing Stored Procedures with JUnit

初期の XP を採用したプロジェクトの話です。私たちのアプリケーションに、
他のグループで開発されたストアドプロシージャを使うように命令されました。

私たちの Java アプリケーションとそれらの開発者による PLSQL コードを結合
するたびに、ストアドプロシージャの基本的な振る舞いについて重大なバグを
見つけていたように思います。

私たちは、自身のコードについて JUnit で自動化テストを書いていました。し
かし、ストアドプロシージャのユニットテストも書くことで、インターフェー
スの契約が明快になることや、他のグループのコードの品質が向上するだろう
と思っていましたが、強制することはできませんでした。当時は utPLSTL のよ
うなツールはなかったからです。

私たちは、xUnit ファミリーの中でもよく慣れていた JUnit でストアドプロシー
ジャのユニットテストを書いてみることにしました。

ストアドプロシージャにアクセスするには JDBC のコードを書く必要があった
ので、ストアドプロシージャごとに、自作の JDBC PreparedStatement クラス
を使った JUnit テストを書きました。

テストは、ストアドプロシージャの基本的な振る舞いと、いくつかの異常系を
実行しました。ストアドプロシージャの新しいバージョンを受け取ったら、ア
プリケーションコードから動かしてみる前に JUnit を実行したものです。言う
までもなく、いくつかのテストは失敗しました

私たちは、ストアドプロシージャの開発グループのメンバーに、私たちのテス
トを見せました。成功したテスト、失敗したテスト、どちらでもないものも含
めてです。

彼らはばつの悪い思いをしたでしょうが、私たちのテストが正しいことを認め、
ストアドプロシージャを修正しに行きました。そしてテストのために新しいバー
ジョンを持ってきました。新しいバージョンのコードのいくつかはうまくいき
ましたが、やはり失敗するものもありました。このとき、とても重要なことが
起こりました。彼らは、私たちの書いたテストのコピーと、それを彼ら自身で
実行するための説明がして欲しいと言ってきたのです。それ以来、彼らは
PLSQL のユニットテストを JUnit で書くようになったのです !
